// Generated by CoffeeScript 1.7.1
var Validation;

Validation = (function() {
  function Validation() {}

  Validation.checkProduct = function(id) {
    var valid;
    valid = true;
    if (id === "") {
      $('#errors ul').append("<li>Bitte geben Sie eine Produkt-ID ein.</li>");
      valid = false;
    }
    id = parseFloat(id);
    if (Math.floor(id) !== id || !$.isNumeric(id)) {
      $('#errors ul').append("<li>Die Produkt-ID muss eine ganze Zahl sein.</li>");
      valid = false;
    }
    if (!valid) {
      $('#product-input').addClass("has-error");
      $('#errors').addClass("alert alert-danger");
    }
    return valid;
  };

  Validation.checkStore = function(id) {
    var valid;
    valid = true;
    if (!id || id === "") {
      $('#errors ul').append("<li>Sie müssen einen Markt auswählen</li>");
      valid = false;
    }
    if (!valid) {
      $('#store-input').addClass("has-error");
      $('#errors').addClass("alert alert-danger");
    }
    return valid;
  };

  Validation.removeClasses = function() {
    $('#errors').removeClass("alert alert-danger");
    $('#store-input').removeClass("has-error");
    $('#product-input').removeClass("has-error");
    return $('#errors ul').html("");
  };

  return Validation;

})();

$(function() {
  var lastStore;
  lastStore = localStorage.getItem('lastStore');
  $("#city_id").val(lastStore);
  $('#city_id').change(function() {
    var curr;
    curr = $(this).val();
    return localStorage.setItem('lastStore', curr);
  });
  return $('#submit').click(function(e) {
    var city_id, product_id, url, valid_city, valid_product;
    e.preventDefault();
    Validation.removeClasses();
    city_id = $('#city_id').val();
    product_id = $('#product_id').val();
    url = "http://www.mediamarkt.de/webapp/wcs/stores/servlet/MultiChannelCatalogEntryAlternativeStoreAjax?storeId=48353&langId=-3&catEntryId=" + product_id + "&pickUpStoreId=" + city_id;
    valid_city = Validation.checkStore(city_id);
    valid_product = Validation.checkProduct(product_id);
    if (valid_product && valid_city) {
      return window.location = url;
    }
  });
});
